generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["connectOrCreate", "atomicNumberOperations"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model JournalEntry {
  id           Int           @id @default(autoincrement())
  userId       String        @map("user_id")
  entryDate    DateTime      @map("entry_date")
  user         User          @relation(fields: [userId], references: [id])
  nutritionLog NutritionLog?

  @@unique([userId, entryDate], name: "userEntryDateUnique")
  @@map("journal_entry")
}

model User {
  id                  String               @id @default(dbgenerated())
  username            String               @unique
  email               String               @unique
  password            String
  createdAt           DateTime             @default(now()) @map("created_at")
  firstName           String?              @map("first_name")
  lastName            String?              @map("last_name")
  journalEntries      JournalEntry[]
  userNutrientTargets UserNutrientTarget[] @relation("user_nutrient_targetTousers")

  @@map("users")
}

model NutritionLog {
  id                          Int                          @id @default(autoincrement())
  journalId                   Int                          @unique @default(autoincrement()) @map("journal_id")
  waterConsumed               Int                          @default(0) @map("water_consumed")
  journalEntry                JournalEntry                 @relation(fields: [journalId], references: [id])
  logMeals                    LogMeal[]                    @relation("log_mealTonutrition_log")
  nutritionLogNutrientTargets NutritionLogNutrientTarget[] @relation("nutrition_logTonutrition_log_nutrient_target")

  @@map("nutrition_log")
}

model Food {
  id                 Int                  @id @default(autoincrement())
  name               String
  foodNutrientAmount FoodNutrientAmount[]
  log_food           LogFood[]            @relation("foodTolog_food")

  @@map("food")
}

model FoodNutrientAmount {
  foodId         Int          @default(autoincrement()) @map("food_id")
  nutrientInfoId Int          @default(autoincrement()) @map("nutrient_info_id")
  amount         Int          @default(0)
  food           Food         @relation(fields: [foodId], references: [id])
  nutrientInfo   NutrientInfo @relation(fields: [nutrientInfoId], references: [id])

  @@id([foodId, nutrientInfoId])
  @@map("food_nutrient_amount")
}

model LogFood {
  id        Int     @id @default(autoincrement())
  logMealId Int     @default(autoincrement()) @map("log_meal_id")
  foodId    Int     @default(autoincrement()) @map("food_id")
  quantity  Float   @default(0)
  food      Food    @relation("foodTolog_food", fields: [foodId], references: [id])
  logMeal   LogMeal @relation(fields: [logMealId], references: [id])

  @@map("log_food")
}

model LogMeal {
  id             Int          @id @default(autoincrement())
  mealTimeName   String       @map("meal_time_name")
  nutritionLogId Int          @default(autoincrement()) @map("nutrition_log_id")
  nutritionLog   NutritionLog @relation("log_mealTonutrition_log", fields: [nutritionLogId], references: [id])
  logFood        LogFood[]

  @@map("log_meal")
}

model NutrientInfo {
  id                          Int                          @id @default(autoincrement())
  name                        String                       @unique
  unit                        String
  foodNutrientAmounts         FoodNutrientAmount[]
  NutritionLogNutrientTargets NutritionLogNutrientTarget[] @relation("nutrient_infoTonutrition_log_nutrient_target")
  userNutrientTargets         UserNutrientTarget[]         @relation("nutrient_infoTouser_nutrient_target")

  @@map("nutrient_info")
}

model UserNutrientTarget {
  userId       String       @map("user_id")
  nutrientId   Int          @default(autoincrement()) @map("nutrient_id")
  amount       Int          @default(0)
  nutrientInfo NutrientInfo @relation("nutrient_infoTouser_nutrient_target", fields: [nutrientId], references: [id])
  users        User         @relation("user_nutrient_targetTousers", fields: [userId], references: [id])

  @@id([userId, nutrientId])
  @@map("user_nutrient_target")
}

model NutritionLogNutrientTarget {
  nutritionLogId Int          @default(autoincrement()) @map("nutrition_log_id")
  nutrientId     Int          @default(autoincrement()) @map("nutrient_id")
  amount         Int          @default(0)
  nutrientInfo   NutrientInfo @relation("nutrient_infoTonutrition_log_nutrient_target", fields: [nutrientId], references: [id])
  nutritionLog   NutritionLog @relation("nutrition_logTonutrition_log_nutrient_target", fields: [nutritionLogId], references: [id])

  @@id([nutritionLogId, nutrientId])
  @@map("nutrition_log_nutrient_target")
}
