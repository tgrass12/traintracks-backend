generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["connectOrCreate", "atomicNumberOperations"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model JournalEntry {
  id           Int           @id @default(autoincrement())
  userId       String        @map("user_id")
  entryDate    DateTime      @map("entry_date")
  user         User          @relation(fields: [userId], references: [id])
  nutritionLog NutritionLog? @relation("journal_entryTonutrition_log")

  @@unique([userId, entryDate], name: "userEntryDateUnique")
  @@map("journal_entry")
}

model User {
  id                  String               @id @default(dbgenerated())
  createdAt           DateTime             @default(now()) @map("created_at")
  username            String               @unique
  email               String               @unique
  password            String
  firstName           String?              @map("first_name")
  lastName            String?              @map("last_name")
  journalEntries      JournalEntry[]
  userNutrientTargets UserNutrientTarget[] @relation("user_nutrient_targetTousers")

  @@map("users")
}

model NutritionLog {
  id                          Int                          @id @default(autoincrement())
  journalEntryId              Int                          @unique @map("journal_entry_id")
  waterIntake                 Int                          @default(0) @map("water_intake")
  journalEntry                JournalEntry                 @relation("journal_entryTonutrition_log", fields: [journalEntryId], references: [id])
  mealOccasions               LogMealOccasion[]            @relation("log_meal_occasionTonutrition_log")
  nutritionLogNutrientTargets NutritionLogNutrientTarget[] @relation("nutrition_logTonutrition_log_nutrient_target")

  @@map("nutrition_log")
}

model Food {
  id                  Int                  @id @default(autoincrement())
  name                String
  foodNutrientAmounts FoodNutrientAmount[]
  logFoods            LogFood[]            @relation("foodTolog_food")

  @@map("food")
}

model FoodNutrientAmount {
  foodId         Int          @map("food_id")
  nutrientInfoId Int          @map("nutrient_info_id")
  amount         Int          @default(0)
  food           Food         @relation(fields: [foodId], references: [id])
  nutrientInfo   NutrientInfo @relation(fields: [nutrientInfoId], references: [id])

  @@id([foodId, nutrientInfoId])
  @@map("food_nutrient_amount")
}

model LogFood {
  id                Int             @id @default(autoincrement())
  logMealOccasionId Int             @map("log_meal_occasion_id")
  foodId            Int             @map("food_id")
  servings          Float           @default(0)
  food              Food            @relation("foodTolog_food", fields: [foodId], references: [id])
  logMealOccasion   LogMealOccasion @relation("log_foodTolog_meal_occasion", fields: [logMealOccasionId], references: [id])

  @@map("log_food")
}

model NutrientInfo {
  id                          Int                          @id @default(autoincrement())
  name                        String                       @unique
  unit                        String
  foodNutrientAmounts         FoodNutrientAmount[]
  NutritionLogNutrientTargets NutritionLogNutrientTarget[] @relation("nutrient_infoTonutrition_log_nutrient_target")
  userNutrientTargets         UserNutrientTarget[]         @relation("nutrient_infoTouser_nutrient_target")

  @@map("nutrient_info")
}

model UserNutrientTarget {
  userId       String       @map("user_id")
  nutrientId   Int          @map("nutrient_id")
  amount       Int          @default(0)
  nutrientInfo NutrientInfo @relation("nutrient_infoTouser_nutrient_target", fields: [nutrientId], references: [id])
  users        User         @relation("user_nutrient_targetTousers", fields: [userId], references: [id])

  @@id([userId, nutrientId])
  @@map("user_nutrient_target")
}

model NutritionLogNutrientTarget {
  nutritionLogId Int          @map("nutrition_log_id")
  nutrientId     Int          @map("nutrient_id")
  amount         Int          @default(0)
  nutrientInfo   NutrientInfo @relation("nutrient_infoTonutrition_log_nutrient_target", fields: [nutrientId], references: [id])
  nutritionLog   NutritionLog @relation("nutrition_logTonutrition_log_nutrient_target", fields: [nutritionLogId], references: [id])

  @@id([nutritionLogId, nutrientId])
  @@map("nutrition_log_nutrient_target")
}

model UserSession {
  sid    String   @id
  sess   Json
  expire DateTime

  @@index([expire], name: "IDX_session_expire")
  @@map("user_session")
}

model LogMealOccasion {
  id             Int          @id @default(autoincrement())
  name           String       @map("occasion_name")
  nutritionLogId Int          @map("nutrition_log_id")
  nutritionLog   NutritionLog @relation("log_meal_occasionTonutrition_log", fields: [nutritionLogId], references: [id])
  foods          LogFood[]    @relation("log_foodTolog_meal_occasion")

  @@map("log_meal_occasion")
}
